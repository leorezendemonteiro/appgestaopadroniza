<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CORRETAGESTAO02</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    .input { padding: 0.5rem; border: 1px solid #ccc; border-radius: 0.25rem; width: 100%; }
    .botao { background-color: #16a34a; color: white; padding: 0.5rem 1rem; border-radius: 0.25rem; width: 100%; }
    .aba { padding: 0.5rem 1rem; border-radius: 0.25rem; background-color: #e5e7eb; transition: 0.3s; white-space: nowrap; }
    .aba:hover { background-color: #2563eb; color: white; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    .scroll-container { max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body class="bg-gray-100">
  <div id="telaInicial" class="flex flex-col items-center justify-center h-screen p-4">
    <h1 class="text-2xl font-bold mb-4">üìä Padroniza DRE</h1>
    <form id="formInicio" class="w-full max-w-xs">
      <input id="empresaNome" type="text" placeholder="Nome da Empresa" class="mb-2 input" />
      <input id="empresaCNPJ" type="text" placeholder="CNPJ" class="mb-4 input" />
      <button type="submit" class="botao">Iniciar DRE</button>
    </form>
  </div>

  <div id="app" class="hidden p-4">
    <div class="flex gap-2 mb-4 overflow-x-auto">
      <button onclick="abrirAba('calibracao')" class="aba">Calibra√ß√£o</button>
      <button onclick="abrirAba('receitas')" class="aba">Receitas</button>
      <button onclick="abrirAba('cmv')" class="aba">CMV</button>
      <button onclick="abrirAba('fixas')" class="aba">Fixas</button>
      <button onclick="abrirAba('maoObra')" class="aba">M√£o de Obra</button>
      <button onclick="abrirAba('relatorio')" class="aba">Relat√≥rio</button>
    </div>
    <div id="conteudo"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const conteudo = document.getElementById("conteudo");
      const dados = {
        calibracao: JSON.parse(localStorage.getItem("calibracao")) || {},
        receitas: JSON.parse(localStorage.getItem("receitas")) || [],
        cmv: JSON.parse(localStorage.getItem("cmv")) || [],
        fixas: JSON.parse(localStorage.getItem("fixas")) || [],
        maoObra: JSON.parse(localStorage.getItem("maoObra")) || []
      };

      document.getElementById("formInicio").addEventListener("submit", function (e) {
        e.preventDefault();
        const nome = document.getElementById("empresaNome").value;
        const cnpj = document.getElementById("empresaCNPJ").value;
        if (!nome || !cnpj) return alert("Preencha todos os campos.");
        localStorage.setItem("empresaNome", nome);
        localStorage.setItem("empresaCNPJ", cnpj);
        document.getElementById("telaInicial").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        abrirAba("calibracao");
      });

      window.abrirAba = function (aba) {
        if (aba === "calibracao") renderCalibracao();
        if (aba === "receitas") renderReceitas();
        if (aba === "cmv") renderCMV();
        if (aba === "fixas") renderFixas();
        if (aba === "maoObra") renderMaoObra();
        if (aba === "relatorio") renderRelatorio();
      };

      function renderCalibracao() {
        conteudo.innerHTML = \`
          <h2 class="text-xl font-bold mb-4">Calibra√ß√£o de Impostos e Taxas</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="number" id="imposto" class="input" placeholder="Imposto sobre faturamento (%)" value="\${dados.calibracao.imposto || ''}" />
            <input type="number" id="debito" class="input" placeholder="Taxa de D√©bito (%)" value="\${dados.calibracao.debito || ''}" />
            <input type="number" id="credito" class="input" placeholder="Taxa de Cr√©dito (%)" value="\${dados.calibracao.credito || ''}" />
            <input type="number" id="apps" class="input" placeholder="Comiss√£o de Apps (%)" value="\${dados.calibracao.apps || ''}" />
            <input type="number" id="encargos" class="input" placeholder="Encargos diversos" value="\${dados.calibracao.encargos || ''}" />
          </div>
          <button onclick="salvarCalibracao()" class="mt-4 botao">Salvar</button>
        \`;
      }

      window.salvarCalibracao = function () {
        const calibracao = {
          imposto: document.getElementById("imposto").value,
          debito: document.getElementById("debito").value,
          credito: document.getElementById("credito").value,
          apps: document.getElementById("apps").value,
          encargos: document.getElementById("encargos").value
        };
        localStorage.setItem("calibracao", JSON.stringify(calibracao));
        alert("Calibra√ß√£o salva com sucesso!");
      };

      function renderReceitas() {
        conteudo.innerHTML = \`
          <h2 class="text-xl font-bold mb-4">Lan√ßamento de Receitas</h2>
          <input id="novaReceita" type="number" class="input" placeholder="Valor da Receita" />
          <button onclick="adicionarReceita()" class="mt-2 botao">Adicionar Receita</button>
          <div class="scroll-container">
            <table><thead><tr><th>Valor</th></tr></thead><tbody id="listaReceitas"></tbody></table>
          </div>
        \`;
        atualizarTabela("receitas", "listaReceitas");
      }

      window.adicionarReceita = function () {
        const valor = parseFloat(document.getElementById("novaReceita").value);
        if (!valor) return;
        dados.receitas.push(valor);
        localStorage.setItem("receitas", JSON.stringify(dados.receitas));
        atualizarTabela("receitas", "listaReceitas");
      }

      function renderCMV() {
        conteudo.innerHTML = \`
          <h2 class="text-xl font-bold mb-4">CMV (Despesas Vari√°veis)</h2>
          <input id="novoCMV" type="number" class="input" placeholder="Valor do CMV" />
          <button onclick="adicionarCMV()" class="mt-2 botao">Adicionar Despesa CMV</button>
          <div class="scroll-container">
            <table><thead><tr><th>Valor</th></tr></thead><tbody id="listaCMV"></tbody></table>
          </div>
        \`;
        atualizarTabela("cmv", "listaCMV");
      }

      window.adicionarCMV = function () {
        const valor = parseFloat(document.getElementById("novoCMV").value);
        if (!valor) return;
        dados.cmv.push(valor);
        localStorage.setItem("cmv", JSON.stringify(dados.cmv));
        atualizarTabela("cmv", "listaCMV");
      }

      function atualizarTabela(tipo, elementoId) {
        const tbody = document.getElementById(elementoId);
        if (!tbody) return;
        tbody.innerHTML = dados[tipo].map(r => \`<tr><td>R$ \${parseFloat(r).toFixed(2)}</td></tr>\`).join('');
      }

      function renderRelatorio() {
        conteudo.innerHTML = \`
          <h2 class="text-xl font-bold mb-4">Relat√≥rio DRE</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <select id="tipoRelatorio" class="input">
              <option value="mensal">Mensal</option>
              <option value="anual">Anual</option>
            </select>
            <input type="month" id="periodoRelatorio" class="input" />
          </div>
          <button onclick="gerarPDF()" class="mt-4 botao">Gerar PDF</button>
        \`;
      }

      window.gerarPDF = function () {
        const tipo = document.getElementById("tipoRelatorio").value;
        const periodo = document.getElementById("periodoRelatorio").value;
        const doc = new jspdf.jsPDF();
        doc.text("Relat√≥rio DRE - " + tipo.toUpperCase(), 20, 20);
        doc.text("Per√≠odo: " + periodo, 20, 30);
        doc.text("Empresa: " + localStorage.getItem("empresaNome"), 20, 40);
        doc.text("CNPJ: " + localStorage.getItem("empresaCNPJ"), 20, 50);
        doc.save("relatorio-dre-" + tipo + ".pdf");
      }
    });
  </script>
</body>
</html>
