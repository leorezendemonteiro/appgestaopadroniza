<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>App de Gestão DRE - Offline</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .tab-button.active { border-color: #3b82f6; background-color: #eff6ff; color: #2563eb; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .dre-item { display: flex; justify-content: space-between; padding: 0.75rem; border-bottom: 1px solid #e5e7eb; }
    .dre-item.total { font-weight: 700; background-color: #f9fafb; }
    .dre-item.net-profit { font-weight: 700; background-color: #d1fae5; color: #065f46; }
    .dre-item.net-loss { font-weight: 700; background-color: #fee2e2; color: #991b1b; }
    .indicator-item { background-color: #f9fafb; padding: 1rem; border-radius: 0.5rem; }
  </style>
</head>
<body class="bg-gray-100">
  <!-- conteúdo visual preservado -->
  <script>
    const tabsContainer = document.getElementById('tabs-container');
    const tabContents = document.querySelectorAll('.tab-content');
    tabsContainer.addEventListener('click', (e) => {
      const tab = e.target.closest('.tab-button');
      if (!tab) return;
      tabsContainer.querySelectorAll('.tab-button').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      tabContents.forEach(c => c.classList.remove('active'));
      document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
    });

    const forms = document.querySelectorAll('form');
    const transactionsList = document.getElementById('transactions-list');
    const monthFilter = document.getElementById('month-filter');
    const viewMode = document.getElementById('view-mode');
    const dreContainer = document.getElementById('dre-container');
    const indicatorsContainer = document.getElementById('indicators-container');

    function saveLocal(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }

    function loadLocal(key) {
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : null;
    }

    function formatCurrency(v) {
      return v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function getTransactions() {
      return loadLocal('transactions') || [];
    }

    function filterTransactions(transactions) {
      const mode = viewMode.value;
      const date = new Date(monthFilter.value + '-01');
      return transactions.filter(t => {
        const d = new Date(t.date);
        return mode === 'monthly'
          ? d.getFullYear() === date.getFullYear() && d.getMonth() === date.getMonth()
          : d.getFullYear() === date.getFullYear();
      });
    }

    function renderTransactionsTable(transactions) {
      transactionsList.innerHTML = '';
      if (transactions.length === 0) {
        transactionsList.innerHTML = '<tr><td colspan="3" class="text-center text-gray-500 p-4">Nenhum lançamento.</td></tr>';
        return;
      }
      transactions.forEach((t, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${t.subCategory || t.description || '-'}</td><td>${formatCurrency(t.amount)}</td><td><button class="text-red-600" onclick="deleteTransaction(${i})">Excluir</button></td>`;
        transactionsList.appendChild(tr);
      });
    }

    function deleteTransaction(index) {
      const all = getTransactions();
      all.splice(index, 1);
      saveLocal('transactions', all);
      loadAndRender();
    }

    function renderDRE(transactions) {
      const settings = loadLocal('settings') || {};
      const grupos = {
        RECEITA_BRUTA: 0,
        CUSTOS_VARIAVEIS: 0,
        DESPESAS_FIXAS: 0,
        MAO_DE_OBRA: 0,
      };
      transactions.forEach(t => grupos[t.main] += t.amount);
      const impostos = grupos.RECEITA_BRUTA * ((settings.taxRate || 0) / 100);
      const lucroBruto = grupos.RECEITA_BRUTA - grupos.CUSTOS_VARIAVEIS;
      const resultado = lucroBruto - grupos.DES...

(continua automaticamente na próxima atualização se necessário)
