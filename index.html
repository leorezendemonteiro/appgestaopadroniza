<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CORRETAGESTAO02</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    .input { padding: 0.5rem; border: 1px solid #ccc; border-radius: 0.25rem; width: 100%; }
    .botao { background-color: #16a34a; color: white; padding: 0.5rem 1rem; border-radius: 0.25rem; width: 100%; }
    .aba { padding: 0.5rem 1rem; border-radius: 0.25rem; background-color: #e5e7eb; transition: 0.3s; white-space: nowrap; }
    .aba:hover { background-color: #2563eb; color: white; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
  </style>
</head>
<body class="bg-gray-100">
  <div id="telaInicial" class="flex flex-col items-center justify-center h-screen p-4">
    <h1 class="text-2xl font-bold mb-4">游늵 Padroniza DRE</h1>
    <form id="formInicio" class="w-full max-w-xs">
      <input id="empresaNome" type="text" placeholder="Nome da Empresa" class="mb-2 input" />
      <input id="empresaCNPJ" type="text" placeholder="CNPJ" class="mb-4 input" />
      <button type="submit" class="botao">Iniciar DRE</button>
    </form>
  </div>

  <div id="app" class="hidden p-4">
    <div class="flex gap-2 mb-4 overflow-x-auto">
      <button onclick="abrirAba('calibracao')" class="aba">Calibra칞칚o</button>
      <button onclick="abrirAba('receitas')" class="aba">Receitas</button>
      <button onclick="abrirAba('cmv')" class="aba">CMV</button>
      <button onclick="abrirAba('fixas')" class="aba">Fixas</button>
      <button onclick="abrirAba('maoObra')" class="aba">M칚o de Obra</button>
      <button onclick="abrirAba('relatorio')" class="aba">Relat칩rio</button>
    </div>
    <div id="conteudo"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const conteudo = document.getElementById("conteudo");
      const dados = {
        calibracao: JSON.parse(localStorage.getItem("calibracao")) || {},
        receitas: JSON.parse(localStorage.getItem("receitas")) || [],
        cmv: JSON.parse(localStorage.getItem("cmv")) || [],
        fixas: JSON.parse(localStorage.getItem("fixas")) || [],
        maoObra: JSON.parse(localStorage.getItem("maoObra")) || []
      };

      document.getElementById("formInicio").addEventListener("submit", function (e) {
        e.preventDefault();
        const nome = document.getElementById("empresaNome").value;
        const cnpj = document.getElementById("empresaCNPJ").value;
        if (!nome || !cnpj) return alert("Preencha todos os campos.");
        localStorage.setItem("empresaNome", nome);
        localStorage.setItem("empresaCNPJ", cnpj);
        document.getElementById("telaInicial").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        abrirAba("calibracao");
      });

      window.abrirAba = function (aba) {
        if (aba === "calibracao") renderCalibracao();
        if (aba === "receitas") renderReceitas();
        if (aba === "cmv") renderCMV();
        if (aba === "fixas") renderFixas();
        if (aba === "maoObra") renderMaoObra();
        if (aba === "relatorio") renderRelatorio();
      };

      function renderFixas() {
        conteudo.innerHTML = `<h2 class="text-xl font-bold mb-4">Despesas Fixas</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input id="descricaoFixa" class="input" placeholder="Descri칞칚o" />
          <input id="valorFixa" class="input" type="number" placeholder="Valor (R$)" />
          <input id="dataFixa" class="input" type="date" />
        </div>
        <button onclick="salvarFixa()" class="mt-4 botao">Salvar Fixa</button>
        <div id="listaFixas" class="mt-6"></div>`;
        renderListaFixas();
      }

      window.salvarFixa = function () {
        const nova = {
          descricao: document.getElementById("descricaoFixa").value,
          valor: parseFloat(document.getElementById("valorFixa").value || 0),
          data: document.getElementById("dataFixa").value
        };
        dados.fixas.push(nova);
        localStorage.setItem("fixas", JSON.stringify(dados.fixas));
        abrirAba("fixas");
      }

      function renderListaFixas() {
        let html = `<table><thead><tr><th>Descri칞칚o</th><th>Valor</th><th>Data</th><th>A칞칚o</th></tr></thead><tbody>`;
        dados.fixas.forEach((item, i) => {
          html += `<tr><td>${item.descricao}</td><td>R$ ${item.valor.toFixed(2)}</td><td>${item.data}</td><td><button onclick="excluirFixa(${i})" class="text-red-500">Excluir</button></td></tr>`;
        });
        html += `</tbody></table>`;
        document.getElementById("listaFixas").innerHTML = html;
      }

      window.excluirFixa = function (index) {
        dados.fixas.splice(index, 1);
        localStorage.setItem("fixas", JSON.stringify(dados.fixas));
        abrirAba("fixas");
      }

      function renderMaoObra() {
        conteudo.innerHTML = `<h2 class="text-xl font-bold mb-4">M칚o de Obra</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input id="funcionario" class="input" placeholder="Funcion치rio" />
          <input id="salario" class="input" type="number" placeholder="Sal치rio (R$)" />
          <input id="dataPagamento" class="input" type="date" />
        </div>
        <button onclick="salvarMaoObra()" class="mt-4 botao">Salvar</button>
        <div id="listaMaoObra" class="mt-6"></div>`;
        renderListaMaoObra();
      }

      window.salvarMaoObra = function () {
        const nova = {
          funcionario: document.getElementById("funcionario").value,
          salario: parseFloat(document.getElementById("salario").value || 0),
          data: document.getElementById("dataPagamento").value
        };
        dados.maoObra.push(nova);
        localStorage.setItem("maoObra", JSON.stringify(dados.maoObra));
        abrirAba("maoObra");
      }

      function renderListaMaoObra() {
        let html = `<table><thead><tr><th>Funcion치rio</th><th>Sal치rio</th><th>Data</th><th>A칞칚o</th></tr></thead><tbody>`;
        dados.maoObra.forEach((item, i) => {
          html += `<tr><td>${item.funcionario}</td><td>R$ ${item.salario.toFixed(2)}</td><td>${item.data}</td><td><button onclick="excluirMaoObra(${i})" class="text-red-500">Excluir</button></td></tr>`;
        });
        html += `</tbody></table>`;
        document.getElementById("listaMaoObra").innerHTML = html;
      }

      window.excluirMaoObra = function (index) {
        dados.maoObra.splice(index, 1);
        localStorage.setItem("maoObra", JSON.stringify(dados.maoObra));
        abrirAba("maoObra");
      }

      function renderRelatorio() {
        conteudo.innerHTML = `<h2 class="text-xl font-bold mb-4">Relat칩rio DRE</h2>
        <button onclick="gerarPDF()" class="botao">Gerar PDF</button>`;
      }

      window.gerarPDF = function () {
        const doc = new jspdf.jsPDF();
        doc.text("Relat칩rio DRE", 20, 20);
        doc.text("Empresa: " + localStorage.getItem("empresaNome"), 20, 30);
        doc.text("CNPJ: " + localStorage.getItem("empresaCNPJ"), 20, 40);
        doc.save("relatorio-dre.pdf");
      }
    });
  </script>
</body>
</html>
