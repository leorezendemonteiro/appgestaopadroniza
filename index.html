<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CORRETAGESTAO02</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="telaInicial" class="flex flex-col items-center justify-center h-screen p-4">
    <h1 class="text-2xl font-bold mb-4">üìä Padroniza DRE</h1>
    <form onsubmit="iniciarApp(); return false;" class="w-full max-w-xs">
      <input id="empresaNome" type="text" placeholder="Nome da Empresa" class="mb-2 p-2 border rounded w-full" />
      <input id="empresaCNPJ" type="text" placeholder="CNPJ" class="mb-4 p-2 border rounded w-full" />
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded w-full">Iniciar DRE</button>
    </form>
  </div>

  <div id="app" class="hidden p-4">
    <div class="flex gap-2 mb-4 overflow-x-auto">
      <button onclick="abrirAba('calibracao')" class="aba">Calibra√ß√£o</button>
      <button onclick="abrirAba('receitas')" class="aba">Receitas</button>
      <button onclick="abrirAba('cmv')" class="aba">CMV</button>
      <button onclick="abrirAba('fixas')" class="aba">Fixas</button>
      <button onclick="abrirAba('maoObra')" class="aba">M√£o de Obra</button>
      <button onclick="abrirAba('relatorio')" class="aba">Relat√≥rio</button>
    </div>
    <div id="conteudo"></div>
  </div>

  <script>
    const conteudo = document.getElementById("conteudo");

    function iniciarApp() {
      const nome = document.getElementById("empresaNome").value;
      const cnpj = document.getElementById("empresaCNPJ").value;
      if (!nome || !cnpj) return alert("Preencha todos os campos.");
      localStorage.setItem("empresaNome", nome);
      localStorage.setItem("empresaCNPJ", cnpj);
      document.getElementById("telaInicial").classList.add("hidden");
      document.getElementById("app").classList.remove("hidden");
      abrirAba("calibracao");
    }

    function abrirAba(aba) {
      const fn = {
        calibracao: renderCalibracao,
        receitas: renderReceitas,
        cmv: renderCmv,
        fixas: renderFixas,
        maoObra: renderMo,
        relatorio: renderRelatorio
      };
      fn[aba]?.();
    }

    function salvarItem(nome, item) {
      const dados = JSON.parse(localStorage.getItem(nome)) || [];
      dados.push(item);
      localStorage.setItem(nome, JSON.stringify(dados));
    }

    function excluirItem(nome, index) {
      const dados = JSON.parse(localStorage.getItem(nome)) || [];
      dados.splice(index, 1);
      localStorage.setItem(nome, JSON.stringify(dados));
      abrirAba(nome);
    }

    function renderCalibracao() {
      conteudo.innerHTML = \`
      <div class="space-y-2">
        <input id="imposto" class="input" type="number" placeholder="Imposto sobre faturamento (%)" />
        <input id="debito" class="input" type="number" placeholder="Taxa de d√©bito (%)" />
        <input id="credito" class="input" type="number" placeholder="Taxa de cr√©dito (%)" />
        <input id="apps" class="input" type="number" placeholder="Comiss√£o de apps/ifood (%)" />
        <input id="app99" class="input" type="number" placeholder="Comiss√£o de apps/99 (%)" />
        <input id="encargos" class="input" type="number" placeholder="Encargos diversos (%)" />
        <button onclick="salvarCalibracao()" class="botao">Salvar Calibra√ß√£o</button>
      </div>\`;
    }

    function salvarCalibracao() {
      const valores = {
        imposto: document.getElementById("imposto").value,
        debito: document.getElementById("debito").value,
        credito: document.getElementById("credito").value,
        apps: document.getElementById("apps").value,
        app99: document.getElementById("app99").value,
        encargos: document.getElementById("encargos").value
      };
      localStorage.setItem("calibracao", JSON.stringify(valores));
      alert("Calibra√ß√£o salva.");
    }

    function renderReceitas() {
      conteudo.innerHTML = \`
        <div class="space-y-2">
          <input id="descReceita" class="input" placeholder="Descri√ß√£o" />
          <input id="valorReceita" class="input" type="number" placeholder="Valor (R$)" />
          <input id="dataReceita" class="input" type="date" />
          <select id="formaRecebimento" class="input">
            <option value="Credito">Cr√©dito</option>
            <option value="Debito">D√©bito</option>
            <option value="Pix">Pix</option>
            <option value="Dinheiro">Dinheiro</option>
            <option value="Ifood">Ifood</option>
            <option value="99">99</option>
          </select>
          <button onclick="salvarReceita()" class="botao">Salvar Receita</button>
        </div>
        <div id="listaReceitas" class="mt-4 space-y-1"></div>
      \`;
      const lista = JSON.parse(localStorage.getItem("receitas")) || [];
      const listaHtml = lista.map((item, i) => \`<div class="bg-white p-2 shadow rounded flex justify-between"><span>\${item.data} - \${item.desc} - R$\${item.valor}</span><button onclick="excluirItem('receitas', \${i})" class="text-red-500">Excluir</button></div>\`).join("");
      document.getElementById("listaReceitas").innerHTML = listaHtml;
    }

    function salvarReceita() {
      const item = {
        desc: document.getElementById("descReceita").value,
        valor: parseFloat(document.getElementById("valorReceita").value),
        data: document.getElementById("dataReceita").value,
        forma: document.getElementById("formaRecebimento").value
      };
      salvarItem("receitas", item);
      abrirAba("receitas");
    }

    function renderCmv() {
      conteudo.innerHTML = \`
        <div class="space-y-2">
          <select id="categoriaCmv" class="input">
            <option>Alimentar</option>
            <option>Produtos de limpeza e higiene</option>
            <option>Embalagens e descart√°veis</option>
            <option>G√°s</option>
            <option>Bebidas e similares</option>
            <option>Outros</option>
          </select>
          <input id="descCmv" class="input" placeholder="Descri√ß√£o" />
          <input id="valorCmv" class="input" type="number" placeholder="Valor (R$)" />
          <input id="dataCmv" class="input" type="date" />
          <input id="fornecedorCmv" class="input" placeholder="Fornecedor" />
          <button onclick="salvarDespesa('cmv')" class="botao">Salvar Despesa Vari√°vel</button>
        </div>
        <div id="listaCmv" class="mt-4 space-y-1"></div>
      \`;
      renderLista("cmv", "listaCmv");
    }

    function renderFixas() {
      conteudo.innerHTML = \`
        <div class="space-y-2">
          <select id="categoriaFixas" class="input">
            <option>Aluguel</option>
            <option>IPTU</option>
            <option>√Ågua</option>
            <option>Energia el√©trica</option>
            <option>Internet/telefone</option>
            <option>Mensalidade de software</option>
            <option>Contabilidade</option>
            <option>Marketing</option>
            <option>Parcela de financiamento</option>
            <option>Pr√≥labore</option>
          </select>
          <input id="valorFixas" class="input" type="number" placeholder="Valor (R$)" />
          <input id="dataFixas" class="input" type="date" />
          <input id="fornecedorFixas" class="input" placeholder="Fornecedor" />
          <button onclick="salvarDespesa('fixas')" class="botao">Salvar Despesa Fixa</button>
        </div>
        <div id="listaFixas" class="mt-4 space-y-1"></div>
      \`;
      renderLista("fixas", "listaFixas");
    }

    function renderMo() {
      conteudo.innerHTML = \`
        <div class="space-y-2">
          <select id="categoriaMo" class="input">
            <option>Sal√°rios</option>
            <option>F√©rias</option>
            <option>Verbas rescis√≥rias</option>
            <option>INSS</option>
            <option>FGTS</option>
            <option>Vale transporte</option>
            <option>Vale alimenta√ß√£o</option>
            <option>Exames peri√≥dicos</option>
            <option>Uniformes</option>
          </select>
          <input id="valorMo" class="input" type="number" placeholder="Valor (R$)" />
          <input id="dataMo" class="input" type="date" />
          <input id="fornecedorMo" class="input" placeholder="Fornecedor" />
          <button onclick="salvarDespesa('maoObra')" class="botao">Salvar M√£o de Obra</button>
        </div>
        <div id="listaMaoObra" class="mt-4 space-y-1"></div>
      \`;
      renderLista("maoObra", "listaMaoObra");
    }

    function salvarDespesa(tipo) {
      const item = {
        categoria: document.getElementById("categoria" + tipo.charAt(0).toUpperCase() + tipo.slice(1)).value,
        valor: parseFloat(document.getElementById("valor" + tipo.charAt(0).toUpperCase() + tipo.slice(1)).value),
        data: document.getElementById("data" + tipo.charAt(0).toUpperCase() + tipo.slice(1)).value,
        fornecedor: document.getElementById("fornecedor" + tipo.charAt(0).toUpperCase() + tipo.slice(1)).value
      };
      salvarItem(tipo, item);
      abrirAba(tipo);
    }

    function renderLista(nome, id) {
      const lista = JSON.parse(localStorage.getItem(nome)) || [];
      const html = lista.map((item, i) => \`<div class="bg-white p-2 shadow rounded flex justify-between"><span>\${item.data} - \${item.categoria || item.desc} - R$\${item.valor}</span><button onclick="excluirItem('\${nome}', \${i})" class="text-red-500">Excluir</button></div>\`).join("");
      document.getElementById(id).innerHTML = html;
    }

    function renderRelatorio() {
      conteudo.innerHTML = '<div class="p-4">Relat√≥rio em desenvolvimento. PDF e resumo ser√£o inclu√≠dos na pr√≥xima etapa.</div>';
    }
  </script>

  <style>
    .input { @apply p-2 border rounded w-full; }
    .botao { @apply bg-green-600 text-white px-4 py-2 rounded w-full; }
    .aba { @apply px-4 py-2 rounded bg-gray-200 hover:bg-blue-600 hover:text-white transition whitespace-nowrap; }
  </style>
</body>
</html>
